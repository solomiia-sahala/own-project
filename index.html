<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://localhost:3000/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
    <title>Share Travel Way</title>
</head>

<body>
    <div id="box">
        <div id="box-inner"></div>

        <form>
            <h4>Hello. Please, sing in!</h4>
            <table>
                <tr>
                    <td>Email:</td>
                    <td>
                        <input type="email" id="email">
                    </td>
                </tr>
                <tr>
                    <td>Password:</td>
                    <td>
                        <input type="password" id="password" placeholder="at least 6 characters">
                    </td>
                </tr>
                <tr>
                    <td><button id="sing-in" class="btn">Sing in</button></td>
                </tr>
            </table>
            <h4>No account yet? Click to <a href="log_in">create</a>.</h4>
        </form>
    </div>

    <header>
        <div id="header-container">
            <img src="http://localhost:3000/static/img/action-blur-car-child-386009.jpg" alt="car">

            <div class="prime-info">
                <h1>Share <span class="colored-word">your way</span> to know more about secret places!</h1>
                <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Vitae rem magni fugiat quis, totam odio
                    veniam perferendis earum voluptates. Labore! Vitae rem magni fugiat quis, totam odio
                    veniam perferendis earum voluptates.</p>
                <button id="logOut" class="btn">Log out!</button>
            </div>
        </div>
    </header>
    <br>

    <hr class="style-seven">

    <section id="blog">
        <h2>Find more info with our <span class="colored-word">articles!</span></h2>
        <div class="articles-container" id="grid_container">
            <!-- <article class="post">
                <img src="./img/house-on-green-landscape-against-sky-314937.jpg" alt="article-1">
                <div>
                    <h3>The least-visited countries in Europe</h3>
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ad laudantium quisquam corrupti
                        repellendus praesentium perspiciatis quam asperiores! Unde iste earum sapiente possimus iusto.
                        Magni, ipsam dolor! Ipsum atque aperiam corrupti?</p>
                    <button class="btn">Read More...</button>
                </div>

            </article>

            <article class="post">
                <img src="./img/man-standing-on-green-grass-field-under-white-sky-1660898.jpg" alt="article-2">
                <div>
                    <h3>Walk hard, play hard</h3>
                    <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Debitis fugit vitae libero cum,
                        aspernatur optio esse autem distinctio aperiam! Alias ullam ea iste fuga?</p>
                    <button class="btn">Read More...</button>
                </div>
            </article>

            <article class="post">
                <img src="./img/road-nature-trees-branches-38537.jpg" alt="article-3">
                <div>
                    <h3> The year to plan a trip with friends</h3>
                    <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Laudantium est nesciunt facilis fuga
                        quo beatae quaerat, aliquam omnis impedit maiores illo asperiores dolores numquam officia rem
                        labore, aut sit modi iste. Consequatur facere officia perspiciatis dignissimos in. Minus, iusto
                        sunt.</p>
                    <button class="btn">Read More...</button>
                </div>
            </article> -->
        </div>
    </section>

    <div class="add-article">
        <a href="create_article"><span>Create article</span></a>
    </div>

    <hr class="style-seven">

    <footer id="footer">
        <section>

        </section>
    </footer>

    <script>
        // store all data in LocalStorage

        // localStorage.setItem('article_1', JSON.stringify({
        //     'header': 'The least-visited countries in Europe',
        //     'description' : 'Lorem ipsum dolor sit amet consectetur adipisicing elit. Ad laudantium quisquam corrupti repellendus praesentium perspiciatis quam asperiores! Unde iste earum sapiente possimus iusto.Magni, ipsam dolor! Ipsum atque aperiam corrupti?',
        //     'image' : './img/house-on-green-landscape-against-sky-314937.jpg',
        // }));

        // localStorage.setItem('article_2', JSON.stringify({
        //     'header': 'Walk hard, play hard',
        //     'description' : 'Lorem ipsum dolor sit amet consectetur adipisicing elit. Ad laudantium quisquam corrupti repellendus praesentium perspiciatis quam asperiores! Unde iste earum sapiente possimus iusto.Magni, ipsam dolor! Ipsum atque aperiam corrupti?',
        //     'image' : './img/man-standing-on-green-grass-field-under-white-sky-1660898.jpg',
        // }));

        // localStorage.setItem('article_3', JSON.stringify({
        //     'header': 'The year to plan a trip with friends',
        //     'description' : 'Lorem ipsum dolor sit amet consectetur adipisicing elit. Ad laudantium quisquam corrupti repellendus praesentium perspiciatis quam asperiores! Unde iste earum sapiente possimus iusto.Magni, ipsam dolor! Ipsum atque aperiam corrupti?',
        //     'image' : './img/road-nature-trees-branches-38537.jpg',
        // }));


        // get all keys with data


        const url = 'https://myourway.firebaseio.com/trip-articles.json';

        async function getData(url) {
            let response = await fetch(url);
            if (response.ok) {
                let json = await response.json();
                let keys = Object.keys(json);
                for (let key of keys) {
                    createElem(json[key], key);
                }
            } else {
                alert(`Error: ${response.status}`);
            }

        }


        // generate new article in grid_container
        function createElem(article, key) {
            grid_container.insertAdjacentHTML('beforeend', '<article class="post">'
                + `<img src="${article.image}" alt="article-2">`
                + `<div><h3>${article.header}</h3>`
                + `<p>${article.description}</p>`
                + `<button id="${key}" class="btn readMe_button">Read More...</button></div></article>`);

            document.getElementById(key).onclick = function () {
                // let url = new URL('http://localhost:3000/read_me');
                // url.searchParams.set('id', key);
                window.location.pathname = `read_me/${key}`;

            }
        }

        // let url = new URL(window.location.href);
        // let header = url.searchParams.get('header');
        // let description = url.searchParams.get('description');
        // let image = url.searchParams.get('myFile');

        // if (header && description && image) {
        //     createElem(header, description, image);
        // } 
        getData(url);

        //log in feature

        //TODO extract to js modele to avoid duplication
        let firebaseConfig = {
            apiKey: "AIzaSyCfUMs20JHDtBfXUWKFlO5FQWQqjW2xQhg",
            authDomain: "myourway.firebaseapp.com",
            databaseURL: "https://myourway.firebaseio.com",
            projectId: "myourway",
            storageBucket: "myourway.appspot.com",
            messagingSenderId: "214953978170",
            appId: "1:214953978170:web:532e1bafdd6ce62d064803"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged(user => {
            //TODO make more meaningful)
            console.log('state: ' + (user == null ? 'logged in' : 'logged out'));
            updateSingInView();
        });

        function updateSingInView() {
            document.getElementById('box').style.setProperty('display', 
                    firebase.auth().currentUser != null ? 'none' : 'block');
        }

        document.getElementById('sing-in').onclick = async function (e) {
            e.preventDefault();
            let email = document.getElementById('email').value;
            let password = document.getElementById('password').value;
            
            try {
                await firebase.auth().signInWithEmailAndPassword(email, password);
            } catch (err) {
                alert(err.message);
                return;
            }
        }

        document.getElementById('logOut').onclick = async function () {
            try {
                await firebase.auth().signOut();
            }
            catch (error) {
                alert(error.message);
            }
        }

    </script>

</body>

</html>